# Workflow

Описание процессов разработки в Claude Code Kit.

## Общий workflow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DEVELOPMENT CYCLE                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐ │
│   │/create-  │-->│/implement│-->│/code-    │-->│/complete-│-->│  /test   │ │
│   │  plan    │   │  (TDD)   │   │  review  │   │   task   │   │  (QA)    │ │
│   └────┬─────┘   └────┬─────┘   └────┬─────┘   └────┬─────┘   └────┬─────┘ │
│        │              │              │              │              │        │
│        v              v              v              v              v        │
│   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐ │
│   │ current- │   │  Atomic  │   │ APPROVED │   │ archive/ │   │  Bug     │ │
│   │ task.md  │   │ Commits  │   │  /REJECT │   │ cleanup  │   │ Reports  │ │
│   └──────────┘   └──────────┘   └──────────┘   └──────────┘   └──────────┘ │
│                                                                             │
│   features.json: planned → in_progress → review → done                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Жизненный цикл задачи в features.json

```
planned → in_progress → review → done
   │           │           │       │
   │           │           │       └── /complete-task: архивация
   │           │           └── /code-review: APPROVED/REJECTED
   │           └── /implement: TDD реализация
   └── /create-plan: создание плана
```

## OODA Loop

Все агенты используют методологию OODA Loop (Observe-Orient-Decide-Act):

```
        ┌─────────────────────────────────┐
        │                                 │
        │      ┌───────────────┐          │
        │      │    OBSERVE    │          │
        │      │ Собери данные │          │
        │      └───────┬───────┘          │
        │              │                  │
        │              v                  │
        │      ┌───────────────┐          │
        │      │    ORIENT     │          │
        │      │ Проанализируй │          │
        │      └───────┬───────┘          │
        │              │                  │
        │              v                  │
        │      ┌───────────────┐          │
        │      │    DECIDE     │          │
        │      │ Прими решение │          │
        │      └───────┬───────┘          │
        │              │                  │
        │              v                  │
        │      ┌───────────────┐          │
        │      │     ACT       │          │
        │      │   Действуй    │──────────┘
        │      └───────────────┘
        │
        └─ Повтори цикл
```

### Observe (Наблюдение)

- Изучи текущее состояние (`progress.md`, `current-task.md`)
- Проверь git status
- Изучи структуру проекта
- Найди релевантный код

### Orient (Ориентация)

- Что уже сделано?
- Какие паттерны используются?
- Какие зависимости учесть?
- Какие риски есть?

### Decide (Решение)

- Выбери подход
- Определи шаги
- Оцени сложность
- Запиши план

### Act (Действие)

- Реализуй решение
- Протестируй
- Закоммить
- Обнови tracking файлы

## TDD Workflow

Test-Driven Development — основа разработки:

```
    ┌─────────────────────────────────────────────┐
    │                TDD CYCLE                     │
    ├─────────────────────────────────────────────┤
    │                                             │
    │   1. WRITE TEST (RED)                       │
    │   ┌─────────────────────────────────────┐   │
    │   │ - Тест описывает expected behavior  │   │
    │   │ - Запусти тест                      │   │
    │   │ - Тест ДОЛЖЕН УПАСТЬ               │   │
    │   └────────────────┬────────────────────┘   │
    │                    │                        │
    │                    v                        │
    │   2. WRITE CODE (GREEN)                     │
    │   ┌─────────────────────────────────────┐   │
    │   │ - Напиши минимум кода               │   │
    │   │ - Только для прохождения теста      │   │
    │   │ - Тест ДОЛЖЕН ПРОЙТИ               │   │
    │   └────────────────┬────────────────────┘   │
    │                    │                        │
    │                    v                        │
    │   3. REFACTOR                               │
    │   ┌─────────────────────────────────────┐   │
    │   │ - Улучши читаемость                 │   │
    │   │ - Убери дублирование                │   │
    │   │ - Тесты всё ещё проходят           │   │
    │   └────────────────┬────────────────────┘   │
    │                    │                        │
    │                    v                        │
    │   4. COMMIT                                 │
    │   ┌─────────────────────────────────────┐   │
    │   │ - git add .                         │   │
    │   │ - git commit -m "type(scope): msg"  │   │
    │   └─────────────────────────────────────┘   │
    │                                             │
    └─────────────────────────────────────────────┘
```

## Этапы разработки фичи

### 1. Планирование (`/create-plan`)

```
Входные данные:
  - Описание фичи от пользователя
  - Контекст проекта (CLAUDE.md, структура)

Процесс:
  1. Изучить существующий код
  2. Найти похожие реализации
  3. Декомпозировать на шаги
  4. Оценить риски

Результат:
  - План в current-task.md
  - Запись в progress.md
  - Обновление features.json (если новая фича)
```

### 2. Реализация (`/implement`)

```
Входные данные:
  - План из current-task.md
  - Baseline (тесты проходят)

Процесс (для каждого шага):
  1. Написать тест (RED)
  2. Написать код (GREEN)
  3. Рефакторинг
  4. Коммит

Результат:
  - Серия атомарных коммитов
  - Обновлённые тесты
  - Отмеченные шаги в current-task.md
```

### 3. Ревью (`/code-review`)

```
Входные данные:
  - Коммиты с реализацией
  - План (что должно было быть сделано)

Процесс:
  1. Понять intent (current-task.md)
  2. Проверить код как независимый ревьюер
  3. Запустить автоматические проверки
  4. Security scan

Результат:
  - Статус: APPROVED / CHANGES REQUESTED / REJECTED
  - Список findings с severity
  - Рекомендации
```

### 4. Тестирование (`/test`)

```
Входные данные:
  - Фича для тестирования
  - Test scenarios matrix

Процесс:
  1. Unit тесты
  2. Integration тесты
  3. E2E тесты (если применимо)
  4. Coverage check

Результат:
  - Test report
  - Coverage metrics
  - Bug reports (если найдены)
```

## Быстрые пути

### Quick Fix (`/quick-fix`)

Для мелких исправлений < 20 строк:

```
Bug → Test → Fix → Verify → Commit
```

### Fix Issue (`/fix-issue`)

Для GitHub issues:

```
Get Issue → Investigate → Plan → TDD Fix → PR
```

## Файлы отслеживания

### progress.md

```markdown
## Session: YYYY-MM-DD HH:MM
**Task:** [что делали]
**Completed:**
- [что завершено]
**Notes:** [заметки]
```

### current-task.md

```markdown
## Task: [название]

### Objective
[цель]

### Implementation Steps
1. [ ] Step 1
2. [ ] Step 2
...

### Success Criteria
- [ ] Criterion 1
- [ ] Criterion 2
```

### features.json

```json
{
  "project": "project-name",
  "features": [
    {
      "id": "F001",
      "name": "Feature Name",
      "status": "in_progress|done|planned",
      "priority": "P0|P1|P2"
    }
  ]
}
```

### decisions.md

```markdown
## [DATE] - Decision Title

**Context:** [почему нужно было решение]
**Decision:** [что решили]
**Consequences:** [последствия]
```

## Commit Convention

```
type(scope): description

Types:
- feat: новая функциональность
- fix: исправление бага
- refactor: рефакторинг
- test: тесты
- docs: документация
- chore: maintenance

Example:
feat(auth): add JWT validation

- Add validateToken() function
- Add tests for valid/invalid tokens

Step 2/5 of F001
```

## Правила

### Обязательно

- Читать `progress.md` в начале сессии
- Обновлять `progress.md` в конце сессии
- Работать над одной фичей за раз
- Использовать `/create-plan` для фич > 50 LOC
- Использовать `/code-review` после реализации

### Запрещено

- Пропускать написание тестов
- Оставлять код в нерабочем состоянии
- Коммитить с падающими тестами
- Удалять/комментировать failing tests
- Модифицировать тесты чтобы они "прошли"

## Диаграмма принятия решений

```
                    ┌─────────────────┐
                    │  Новая задача   │
                    └────────┬────────┘
                             │
                             v
                    ┌─────────────────┐
                    │  Размер > 20    │
              ┌─────┤    строк?       ├─────┐
              │     └─────────────────┘     │
              │ Да                          │ Нет
              v                             v
    ┌─────────────────┐           ┌─────────────────┐
    │  Размер > 50    │           │   /quick-fix    │
    │    строк?       │           │                 │
    └────────┬────────┘           └─────────────────┘
             │
    ┌────────┼────────┐
    │ Да     │        │ Нет
    v        │        v
┌────────────┐│    ┌───────────┐
│/create-plan││    │ /implement│
└───┬───┘    │    │ напрямую  │
    │        │    └───────────┘
    v        │
┌────────────┴────────────┐
│      /implement         │
└────────────┬────────────┘
             │
             v
┌─────────────────────────┐
│      /code-review       │
└────────────┬────────────┘
             │
             v
┌─────────────────────────┐
│         /test           │
└─────────────────────────┘
```
